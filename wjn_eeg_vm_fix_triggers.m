function D = wjn_eeg_vm_fix_triggers(spmfile)


D=wjn_sl(spmfile);
spmfile = D.fname;
str = stringsplit(spmfile,'_');

if strcmp(str{2}(1:3),'N01')  
    disp('fixing triggers for N01')
    rt = [   0.4500
    0.5050
    0.5240
    0.4810
    0.4690
    0.3650
    0.4050
    0.3780
    0.3650
    0.4500
    0.3500
    0.3600
    0.3450
    0.3390
    0.3350
    0.4000
    0.4010
    0.4300
    0.4400
    0.4100
    0.2860
    0.4100
    0.3610
    0.3350
    0.3790
    0.3900
    0.3910
    0.3260
    0.3360
    0.3510
    0.3310
    0.3240
    0.3600
    0.4250
    0.3860
    0.3950
    0.3600
    0.3810
    0.3240
    0.3050
    0.3250
    0.3650
    0.3760
    0.3540
    0.4000
    0.3450
    0.3800
    0.3060
    0.3600
    0.3150
    0.2900
    0.3450
    0.3760
    0.3390
    0.3600
    0.3610
    0.3740
    0.3400
    0.3300
    0.3710
    0.4890
    0.5600
    0.4800
    0.4260
    0.4600
    0.4810
    0.4150
    0.4650
    0.4700
    0.3700
    0.4090
    0.6240
    0.4010
    0.4650
    0.3850
    0.4400
    0.4250
    0.4090
    0.4300
    0.4270
    0.4440
    0.3640
    0.4110
    0.3860
    0.4200
    0.3910
    0.3890
    0.3900
    0.3440
    0.3450
    0.4350
    0.4990
    0.3950
    0.3790
    0.3300
    0.4550
    0.4600
    0.4050
    0.4320
    0.3860
    0.3950
    0.4500
    0.4100
    0.4000
    0.3790
    0.4190
    0.3550
    0.4360
    0.4200
    0.4400
    0.3650
    0.4890
    0.3510
    0.4040
    0.5000
    0.3410
    0.3860
    0.4200
    0.4250
    0.3850
    0.4940
    0.3750
    0.3470
    0.3290
    0.3640
    0.3850
    0.3510
    0.3250
    0.3390
    0.3540
    0.3040
    0.2950
    0.3210
    0.3740
    0.3000
    0.3110
    0.3360
    0.3260
    0.3320
    0.3760
    0.3550
    0.3440
    0.4060
    0.3260
    0.3290
    0.4050
    0.3550
    0.4240
    0.3710
    0.3850
    0.3840
    0.3960
    0.3650
    0.4010
    0.3660
    0.3940
    0.3450
    0.2950
    0.3150
    0.3740
    0.3550
    0.3490
    0.3650
    0.3310
    0.3470
    0.3640
    0.3490
    0.3460
    0.3450
    0.3510
    0.3350
    0.3640
    0.3590
    0.3560
    0.3600
    0.3510
    0.3510
    0.3350
    0.3260
    0.3560
    0.4450
    0.4750
    0.4100
    0.4200
    0.5260
    0.6200
    0.5550
    0.4390
    0.4790
    0.4250
    0.4100
    0.3960
    0.4400
    0.4760
    0.4450
    0.4560
    0.4080
    0.4000
    0.3460
    0.5330
    0.5550
    0.4090
    0.3900
    0.3650
    0.3800
    0.4250
    0.3660
    0.4250
    0.4940
    0.4190
    0.3510
    0.3900
    0.4450
    0.4500
    0.4320
    0.4410
    0.4150
    0.4500
    0.3950
    0.4300
    0.4310
    0.4110
    0.4230
    0.4060
    0.4000
    0.4250
    0.3950
    0.5290
    0.4260
    0.3760
    0.3500
    0.4400
    0.4160
    0.4950
    0.4900
    0.3890
    0.4300
    0.4390
    0.4600
    0.4550];
    
    iold = [1:60 121:180];
    inew = [61:120;181:240];
    ev = D.events(:);
    i = ci('Stimulus',{ev(:).type});
    is1 = ci('S  1',{ev(:).value},2);
    is2 = ci('S  2',{ev(:).value},2);
    is3 = ci('S  3',{ev(:).value},2);
    sublag=mean(diff([rt(iold)';[ev(is2(iold)).time]-[ev(is1(iold)).time]]));
    nev = ev(sort([is1(iold),is2(iold),is3(1,:)]));
    nn=0;
    for a = 1:3:3*length(iold)
        nn=nn+1;
        n=a+length(iold)*3;
        nev(n) = nev(a);
        nev(n).value = 'S  9';
        nev(n).time = ev(is1(inew(nn))).time-rt(inew(nn))+sublag;
        nev(n+1) = nev(a);
        nev(n+1).value = 'S 10';
        nev(n+1).time = ev(is1(inew(nn))).time;
        nev(n+2) = nev(a);
        nev(n+2).value = 'S 11';
        nev(n+2).time = ev(is2(inew(nn))).time;
    end
    
    load(D.fname)
    D.trials.events=nev;
    save(D.fname,'D')
    D=wjn_sl(D.fname);
end
    

        
    
    
    
    
  
    
    
